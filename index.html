<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>링크 생성기</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        h1 {
            text-align: center;
            margin-bottom: 20px;
        }
        form {
            max-width: 500px;
            margin: 0 auto;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        label {
            margin-top: 10px;
        }
        button {
            margin-top: 10px;
        }
        .btn-light {
            background-color: #e9ecef;
            border: 1px solid #ced4da;
        }
        #generatedLink {
            margin-top: 20px;
            text-align: center;
            word-break: break-word;
        }
        h2 {
            text-align: center;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>링크 생성기</h1>

    <form id="linkForm">
        <div class="mb-3">
            <label for="action" class="form-label">액션 선택</label>
            <div class="d-flex justify-content-between mb-2">
                <button type="button" class="btn btn-secondary" onclick="sortActionsByIndex()">인덱스별 정렬</button>
                <button type="button" class="btn btn-secondary" onclick="sortActionsByName()">이름별 정렬</button>
            </div>
            <select id="action" name="action" class="form-select" onchange="updateFields()">
                <option value="">-- 선택하세요 --</option>
            </select>
        </div>

        <div class="mb-3" style="display: none;" id="projectWrapper">
            <label for="project" class="form-label">프로젝트 선택</label>
            <select id="project" name="project" class="form-select">
                <option value="COMMON">공통 (COMMON)</option>
                <option value="DELIVERY">배달 (DELIVERY)</option>
                <option value="FLOWER">꽃배달 (FLOWER)</option>
                <option value="TAXI">택시 (TAXI)</option>
                <option value="DRIVER">대리 (DRIVER)</option>
                <option value="BUS">버스 (BUS)</option>
                <option value="MEDICAL">병의원 (MEDICAL)</option>
                <option value="RESERVE">예약 (RESERVE)</option>
                <option value="ELECTRIC">전자관 (ELECTRIC)</option>
                <option value="BIZ">비즈 (BIZ)</option>
                <option value="BIZ_TAXI">비즈_택시 (BIZ_TAXI)</option>
                <option value="BIZ_DRIVER">비즈_대리 (BIZ_DRIVER)</option>
                <option value="BIZ_DELIVERY">비즈_배달 (BIZ_DELIVERY)</option>
                <option value="BIZ_FLOWER">비즈_꽃배달 (BIZ_FLOWER)</option>
            </select>
        </div>

        <div id="dynamicFields"></div>

        <div class="d-flex justify-content-between">
            <button type="button" class="btn btn-warning" onclick="resetAllFields()">전체 초기화</button>
            <button type="button" class="btn btn-secondary" onclick="resetAction()">액션 초기화</button>
            <button type="button" class="btn btn-light" onclick="resetDynamicFields()">필수/선택 초기화</button>
        </div>

        <button type="button" class="btn btn-primary w-100" onclick="generateLink()">링크 생성</button>
    </form>

    <h2>생성된 링크</h2>
    <div class="text-center">
        <p id="generatedLink" class="p-2 bg-light border rounded"></p>
        <button id="copyButton" class="btn btn-secondary" style="display: none;" onclick="copyToClipboard()">복사</button>
    </div>

    <script>
        const actionRequirements = {
            ACTION_LINK_ALARM: { required: [], optional: [], projects: ["COMMON", "DELIVERY", "FLOWER"], display: "1. 알림함으로 이동 (ACTION_LINK_ALARM)" },
            ACTION_LINK_INQUIRY_WRITE: { required: [], optional: [], projects: ["COMMON"], display: "2. 고객소리함 화면으로 이동 (ACTION_LINK_INQUIRY_WRITE)" },
            ACTION_LINK_MILEAGE: { required: [], optional: [], projects: [], display: "3. 마일리지 화면으로 이동 (ACTION_LINK_MILEAGE)" },
            ACTION_LINK_PAY_MANAGEMENT: { required: [], optional: [], projects: ["COMMON", "DELIVERY", "FLOWER"], display: "4. 결제수단 관리 화면으로 이동 (ACTION_LINK_PAY_MANAGEMENT)" },
            ACTION_LINK_COUPON_PUBLISH: { required: [], optional: ["couponCode"], projects: ["COMMON", "DELIVERY", "FLOWER"], display: "5. 쿠폰 등록 화면 (ACTION_LINK_COUPON_PUBLISH)" },
            ACTION_LINK_VOUCHER_PRODUCT_LIST: { required: [], optional: [], projects: ["COMMON", "DELIVERY", "FLOWER"], display: "6. 상품권 구매 화면 (ACTION_LINK_VOUCHER_PRODUCT_LIST)" },
            ACTION_LINK_VOUCHER: { required: [], optional: ["code"], projects: ["COMMON", "DELIVERY", "FLOWER"], display: "7. 상품권 보관함으로 이동 (ACTION_LINK_VOUCHER)" },
            ACTION_LINK_NOTICE: { required: ["code"], optional: [], projects: ["COMMON", "DELIVERY", "FLOWER"], display: "8. 공지사항 상세 (ACTION_LINK_NOTICE)" },
            ACTION_LINK_EVENT: { required: ["eventCode"], optional: [], projects: ["COMMON", "DELIVERY", "FLOWER"], display: "9. 이벤트 상세 (ACTION_LINK_EVENT)" },
        };

        function populateActions() {
            const actionDropdown = document.getElementById('action');
            actionDropdown.innerHTML = '<option value="">-- 선택하세요 --</option>';
            Object.keys(actionRequirements).forEach(key => {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = actionRequirements[key].display;
                actionDropdown.appendChild(option);
            });
        }

        function sortActionsByIndex() {
            const sortedKeys = Object.keys(actionRequirements).sort((a, b) => {
                const indexA = parseInt(actionRequirements[a].display.split('.')[0], 10);
                const indexB = parseInt(actionRequirements[b].display.split('.')[0], 10);
                return indexA - indexB;
            });

            updateActionDropdown(sortedKeys);
        }

        function sortActionsByName() {
            const sortedKeys = Object.keys(actionRequirements).sort((a, b) => {
                return actionRequirements[a].display.localeCompare(actionRequirements[b].display);
            });

            updateActionDropdown(sortedKeys);
        }

        function updateActionDropdown(sortedKeys) {
            const actionDropdown = document.getElementById('action');
            actionDropdown.innerHTML = '<option value="">-- 선택하세요 --</option>';
            sortedKeys.forEach(key => {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = actionRequirements[key].display;
                actionDropdown.appendChild(option);
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            populateActions();
        });

        function updateFields() {
            const action = document.getElementById('action').value;
            const projectWrapper = document.getElementById('projectWrapper');
            const projectDropdown = document.getElementById('project');
            const dynamicFields = document.getElementById('dynamicFields');

            dynamicFields.innerHTML = '';

            if (!action || !actionRequirements[action]) {
                projectWrapper.style.display = 'none';
                return;
            }

            const { required, optional, projects } = actionRequirements[action];

            if (projects.length > 0) {
                projectWrapper.style.display = 'block';
                projectDropdown.innerHTML = '';
                projects.forEach(project => {
                    const option = document.createElement('option');
                    option.value = project;
                    option.textContent = project;
                    projectDropdown.appendChild(option);
                });
            } else {
                projectWrapper.style.display = 'none';
            }

            required.forEach(field => {
                dynamicFields.innerHTML += `
                    <div class="mb-3">
                        <label for="${field}" class="form-label">${field}</label>
                        <input type="text" id="${field}" name="${field}" class="form-control" placeholder="${field} (필수)">
                    </div>
                `;
            });

            optional.forEach(field => {
                dynamicFields.innerHTML += `
                    <div class="mb-3">
                        <label for="${field}" class="form-label">(선택) ${field}</label>
                        <input type="text" id="${field}" name="${field}" class="form-control" placeholder="${field}">
                    </div>
                `;
            });
        }

        function generateLink() {
            const baseUrl = "https://app.daeguro.co.kr/app/public_link.html?";
            const project = document.getElementById('project').value;
            const action = document.getElementById('action').value;

            if (!action) {
                alert('액션을 선택하세요!');
                return;
            }

            const { required, optional } = actionRequirements[action];

            if (project) {
                queryParams = `&project=${project}`;
            }
            
            let queryParams += `action=${action}`;

            for (const field of required) {
                const value = document.getElementById(field)?.value;
                if (!value) {
                    alert(`${field}는 필수 입력 항목입니다.`);
                    return;
                }
                queryParams += `&${field}=${value}`;
            }

            for (const field of optional) {
                const value = document.getElementById(field)?.value;
                if (value) {
                    queryParams += `&${field}=${value}`;
                }
            }

            const fullLink = `${baseUrl}${queryParams}`;

            const linkElement = document.getElementById('generatedLink');
            linkElement.innerText = fullLink;

            document.getElementById('copyButton').style.display = 'inline-block';
        }

        function copyToClipboard() {
            const linkElement = document.getElementById('generatedLink');
            navigator.clipboard.writeText(linkElement.innerText)
                .then(() => alert('링크가 복사되었습니다!'))
                .catch(() => alert('복사에 실패했습니다.'));
        }

        function resetAllFields() {
            document.getElementById('action').value = '';
            document.getElementById('dynamicFields').innerHTML = '';
            document.getElementById('generatedLink').innerText = '';
            document.getElementById('copyButton').style.display = 'none';
            const projectWrapper = document.getElementById('projectWrapper');
            projectWrapper.style.display = 'none';
        }

        function resetAction() {
            document.getElementById('action').value = '';
            updateFields();
        }

        function resetDynamicFields() {
            document.getElementById('dynamicFields').innerHTML = '';
        }
    </script>
</body>
</html>
